___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "IGB Tracker",
  "categories": ["ANALYTICS", "ATTRIBUTION", "CONVERSIONS"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "VONQ Job Post is a multi-post vacancy and programmatic jobmarketing solution. This template allows tracking of completed applications and conversion rations of vacancies on your website posted by VONQ.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "RADIO",
    "name": "trigger",
    "displayName": "Trigger",
    "radioItems": [
      {
        "value": "start",
        "displayValue": "Start"
      },
      {
        "value": "end",
        "displayValue": "Stop"
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "SELECT",
    "name": "method",
    "displayName": "Tracking method",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "textvalue",
        "displayValue": "Textual value"
      },
      {
        "value": "url",
        "displayValue": "Page URL"
      },
      {
        "value": "referer",
        "displayValue": "Referrer URL"
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "RADIO",
    "name": "source",
    "displayName": "Tracking source",
    "radioItems": [
      {
        "value": "query",
        "displayValue": "Query string"
      },
      {
        "value": "path",
        "displayValue": "Page path"
      }
    ],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "method",
        "paramValue": "url",
        "type": "EQUALS"
      },
      {
        "paramName": "method",
        "paramValue": "referer",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "pathVar",
    "displayName": "Regular expression",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "source",
        "paramValue": "path",
        "type": "EQUALS"
      }
    ],
    "valueHint": "/apply\\/(\\d+)-/"
  },
  {
    "type": "TEXT",
    "name": "textValue",
    "displayName": "Text value, either hard-coded or using a variable",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "method",
        "paramValue": "textvalue",
        "type": "EQUALS"
      }
    ],
    "valueHint": "MyRef001 or {{VARIABLE NAME }}",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "queryVar",
    "displayName": "Query parameter",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "source",
        "paramValue": "query",
        "type": "EQUALS"
      }
    ],
    "valueHint": "vacancyID"
  },
  {
    "type": "CHECKBOX",
    "name": "debug",
    "checkboxText": "Log debug messages to console",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const logToConsole = require('logToConsole');
const callInWindow = require('callInWindow');
const queryPermission = require('queryPermission');

const log = data.debug ? logToConsole : (() => {});


const trackerUrl = 'https://beheer.ingoedebanen.nl/js/tracker.js';

const getValueFromUrl = (functionPrefix) => {
  let functionName;
  let argument;
  switch (data.source) {
    case 'query':
      functionName = functionPrefix + 'Var';
      argument = data.queryVar;
      break;
    case 'path':
      functionName = functionPrefix + 'UrlVar';
      argument = data.pathVar;
      break;
    default:
      log('Invalid tracking source: ' + data.source);
      data.gtmOnFailure();      

  }
  
  if (queryPermission('access_globals', 'execute', functionName)) {
    return callInWindow(functionName, argument);
  } else {
    log('Not allowed to call the method ' + functionName);
    data.gtmOnFailure();
    return;
  }
};

const onSuccess = () => {
  log('VONQ Job Post Tracker: script loaded successfully.');
  
  const trigger = 'InGoedeBanenTracker.' + data.trigger;
  let reference;
  switch (data.method) {
    case 'textvalue':
      reference = data.textValue;
      break;
    case 'url':
      reference = getValueFromUrl('InGoedeBanenTracker.get');
      break;
    case 'referer':
      reference = getValueFromUrl('InGoedeBanenTracker.getRefered');
      break;
    default:
      log('Invalid tracking method: ' + data.method);
      data.gtmOnFailure();
      return;
  }

  if (typeof reference === 'undefined' || reference.trim() === '') {
      log('No reference');
      data.gtmOnFailure();
      return;
  }
  if (queryPermission('access_globals', 'execute', trigger)) {
    callInWindow(trigger, reference);
  } else {
    log('Not allowed to call the method ' + trigger);
    data.gtmOnFailure();
    return;
  }

  data.gtmOnSuccess();
};

const onFailure = () => {
  log('VONQ Job Post Tracker: script load failed.');
  data.gtmOnFailure();
};

if (queryPermission('inject_script', trackerUrl)) {
  injectScript(trackerUrl, onSuccess, onFailure, trackerUrl);
} else {
  log('Not allowed to load ' + trackerUrl);
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://beheer.ingoedebanen.nl/js/tracker.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "InGoedeBanenTracker.start"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "InGoedeBanenTracker.end"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "InGoedeBanenTracker.getVar"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "InGoedeBanenTracker.getReferedVar"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "InGoedeBanenTracker.getUrlVar"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "InGoedeBanenTracker.getReferedUrlVar"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Tracker start is called with fixed value
  code: |-
    const mockData = {
      method: 'textvalue',
      textValue: 'Fixed value',
      trigger: 'start'
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.start', 'Fixed value');
    assertApi('gtmOnSuccess').wasCalled();
- name: Tracker end is called with fixed value
  code: |-
    const mockData = {
      method: 'textvalue',
      textValue: 'Fixed value',
      trigger: 'end'
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.end', 'Fixed value');
    assertApi('gtmOnSuccess').wasCalled();
- name: Tracker start is called with query value from URL
  code: |-
    const mockData = {
      method: 'url',
      source: 'query',
      trigger: 'start',
      queryVar: 'queryVariableForStart',
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.getVar', 'queryVariableForStart');
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.start', 'Query value from URL');
    assertApi('gtmOnSuccess').wasCalled();
- name: Tracker end is called with query value from URL
  code: |-
    const mockData = {
      method: 'url',
      source: 'query',
      trigger: 'end',
      queryVar: 'queryVariableForEnd',
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.getVar', 'queryVariableForEnd');
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.end', 'Query value from URL');
    assertApi('gtmOnSuccess').wasCalled();
- name: Tracker start is called with query value from referer URL
  code: |-
    const mockData = {
      method: 'referer',
      source: 'query',
      trigger: 'start',
      queryVar: 'queryVariableForReferedStart',
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.getReferedVar', 'queryVariableForReferedStart');
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.start', 'Query value from referer URL');
    assertApi('gtmOnSuccess').wasCalled();
- name: Tracker end is called with query value from referer URL
  code: |-
    const mockData = {
      method: 'referer',
      source: 'query',
      trigger: 'end',
      queryVar: 'queryVariableForRefererEnd',
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.getReferedVar', 'queryVariableForRefererEnd');
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.end', 'Query value from referer URL');
    assertApi('gtmOnSuccess').wasCalled();
- name: Tracker start is called with path value from URL
  code: |
    const mockData = {
      method: 'url',
      source: 'path',
      trigger: 'start',
      pathVar: 'pathVariableForStart',
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.getUrlVar', 'pathVariableForStart');
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.start', 'Path value from URL');
    assertApi('gtmOnSuccess').wasCalled();
- name: Tracker end is called with path value from URL
  code: |
    const mockData = {
      method: 'url',
      source: 'path',
      trigger: 'end',
      pathVar: 'pathVariableForEnd',
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.getUrlVar', 'pathVariableForEnd');
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.end', 'Path value from URL');
    assertApi('gtmOnSuccess').wasCalled();
- name: Tracker start is called with path value from referer URL
  code: |
    const mockData = {
      method: 'referer',
      source: 'path',
      trigger: 'start',
      pathVar: 'pathVariableForRefererStart',
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.getReferedUrlVar', 'pathVariableForRefererStart');
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.start', 'Path value from referer URL');
    assertApi('gtmOnSuccess').wasCalled();
- name: Tracker end is called with path value from referer URL
  code: |
    const mockData = {
      method: 'referer',
      source: 'path',
      trigger: 'end',
      pathVar: 'pathVariableForRefererEnd',
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.getReferedUrlVar', 'pathVariableForRefererEnd');
    assertApi('callInWindow').wasCalledWith('InGoedeBanenTracker.end', 'Path value from referer URL');
    assertApi('gtmOnSuccess').wasCalled();
- name: Invalid trigger is not allowed
  code: |-
    const mockData = {
      method: 'textvalue',
      textvalue: 'Fixed value',
      trigger: 'invalid'
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    assertApi('callInWindow').wasNotCalled();
    assertApi('gtmOnFailure').wasCalled();
- name: Invalid method is not allowed
  code: |
    const mockData = {
      method: 'invalidMethod',
      trigger: 'start',
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    assertApi('callInWindow').wasNotCalled();
    assertApi('gtmOnFailure').wasCalled();
- name: Invalid source is not allowed
  code: |-
    const mockData = {
      method: 'referer',
      source: 'invalidSource',
      trigger: 'start',
      pathVar: 'pathVariableForRefererEnd',
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    assertApi('callInWindow').wasNotCalled();
    assertApi('gtmOnFailure').wasCalled();
- name: An empty reference is not tracked
  code: |-
    const mockData = {
      method: 'textvalue',
      textValue: '',
      trigger: 'start'
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    assertApi('callInWindow').wasNotCalled();
    assertApi('gtmOnFailure').wasCalled();
- name: A non existing reference is not tracked
  code: |-
    const mockData = {
      method: 'textvalue',
      trigger: 'start'
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    assertApi('callInWindow').wasNotCalled();
    assertApi('gtmOnFailure').wasCalled();
- name: Logging to console when enabled
  code: |-
    mock('logToConsole', (message) => {});

    const mockData = {
      method: 'textvalue',
      textValue: 'Fixed value',
      trigger: 'start',
      debug: true
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    assertApi('logToConsole').wasCalled();
- name: No log to console when not enabled
  code: |-
    mock('logToConsole', (message) => {});

    const mockData = {
      method: 'textvalue',
      textValue: 'Fixed value',
      trigger: 'start',
      debug: false
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    assertApi('logToConsole').wasNotCalled();
setup: |-
  const trackerUrl = 'https://beheer.ingoedebanen.nl/js/tracker.js';

  let success, failure;

  mock('injectScript', (url, s, f) => {
    success = s;
    failure = f;
    s();
  });

  mock('callInWindow', (code, argument) => {
    switch (code) {
      case 'InGoedeBanenTracker.getVar':
        return 'Query value from URL';
      case 'InGoedeBanenTracker.getUrlVar':
        return 'Path value from URL';
      case 'InGoedeBanenTracker.getReferedVar':
        return 'Query value from referer URL';
      case 'InGoedeBanenTracker.getReferedUrlVar':
        return 'Path value from referer URL';
    }
  });


___NOTES___

https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/

https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/


